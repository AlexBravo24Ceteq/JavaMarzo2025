--Ctrl + o para abrir archivos
-- Comentarios de una sola linea

/* Comentarios
de multiples
lineas*/

-- Base de datos
--Es un conjunto de datos organizados entre si y que son
--almacenados en tablas

-- La estructura de las tablas de las bases de datos serian de la sig manera:
--Toda tabla debe llevar tabla primaria (PRIMARY KEY- identificador unico de cada
--registro)
-- Pueden o no llevar llave foranea (FORING KEY - identificador proveniendo de otra tabla
--columnas con sus diferentes tipos de dato.

-- Number: Tipo de dato para almacenar numero tanto enteros como decimales
--VARCHAR, VACHAR2, ...NVARCHAR2- guardad caracteres alfanumericos y especiales
--y gestiona mejor la memoria
--DATE-- tipo de dato para guardar fecha y hora

--Para guaradar los cambios en nuetro script preionar ctrl+s
--CTRL + S

--Primero hay que definir que queremos crear y para que

-- DDL (data deeinition languaje)
--ej. crear una tabla para guardar info de alumnos

CREATE TABLE ALUMNOS(
ALUMNO_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(50),
FECHANAC DATE,
GENERO NVARCHAR2(20),
GRADO NVARCHAR2(30),
CIUDAD NVARCHAR2(30),
STATUS NUMBER 
);


--PARA VER LA ESTRUCTURA de una tabla podemos utilizar un DESCRIBE
DESCRIBE ALUMNOS;

--Eliminar una tabla con todo y sus registros si lo tuviera
DROP TABLE ALUMNOS;

--RENOMBRAR UNA TABLA 
ALTER TABLE ALUMNOS RENAME TO ALUMNO;

-- CREAR UNA TABLA PARA ALMACENAR INFO DE LASS CARRERAS A  LAS CUALES
--PODRAN INSCRIBIRSE LOS ALUMNOS
CREATE TABLE CARRERAS(
CARRERA_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(30),
AREA NVARCHAR2(30),
DURACION NVARCHAR2(30)
);

--CREAR UNA TABLA RELACIONAL N:N PARA PODER RELACIONAR LA INFO DE LOS ALUMNOS
--Y LAS CARRERAS A LAS QUE ESTAN INSCRITOS

CREATE TABLE CARRERAS_ALUMNOS(
CA_ID NUMBER PRIMARY KEY,
ALUMNO_ID NUMBER,
CARRERA_ID NUMBER
);

-- CREACION DE RESTRINCCIONES
--RESTRICCION DE TIPO CHECK
--VERIFICAN QUE SOLO PODAMOS ESCRIBIR EN LAS COLUMNAS LOS VALORES QUE NOSOTROS
--DEFINAMOS
ALTER TABLE ALUMNO ADD CONSTRAINT CHK_GENERO
CHECK ( GENERO IN ('MASCULINO', 'FEMENINO'));

--SI NOS EQUIVAOCAMOS EN LA ESCRITURA DE UNA RESTRICCION, PODEMOS ELIMINARLA
-- Y LUEGO CORREGIRLA Y EJECUTARLA DE NUEVO
ALTER TABLE ALUMNO DROP CONSTRAINT CHK_GENERO;

--RESTRICCION DE TIPO UNIQUE
--Crea o permite tener valores unicos en aquellas columnas que no son llave primary
-- y que no bene repetirse. ej los nombres de las carreras
ALTER TABLE CARRERAS ADD CONSTRAINT UNQ_NOMBRE_CARRERAS
UNIQUE (NOMBRE);

--RESTRICCION DE LLAVES FORANEAS (FOREIGN KEY)
--SIRVEN PARA RESTRINGIR QUE EL VALOR O LLAVE QUE SE RECIBE EXISTA PREVIAMENTE 
--EN LA OTRA TABLA COMO LLAVE PRIMARIA

--EJ. VAMOS A CREAR LA LLAVE FORANE EN CARRERAS_ALUMNOS PARA RECIBIR EL ID DEL ALUMNO
ALTER TABLE CARRERAS_ALUMNOS ADD CONSTRAINT FK_ALUMNO_ID_CA
FOREIGN KEY (ALUMNO_ID)
REFERENCES ALUMNO (ALUMNO_ID);

--EJ. CREAR LA LLAVE FORANEA PARA LA COLUMNA CARRERA_ID
ALTER TABLE CARRERAS_ALUMNOS ADD CONSTRAINT FK_CARRERA_ID_CA
FOREIGN KEY (CARRERA_ID)
REFERENCES CARRERAS (CARRERA_ID);

-- USO DE SENTENCIAS DML(DATA MANIPULATION LANGUAGE)
--SON PARA MANIPULAR O CREAR REGISTROS EN NUESTRAS TABLAS

--EJ. INSERTAR VALORES EN MI TABLA ALUMNO
--VAMOS A REVISAR EN QUE FORMATO ADMITE LA FECHA MI SISTEMA
SELECT SYSDATE FROM DUAL;

DESCRIBE ALUMNO;

INSERT INTO ALUMNO VALUES 
(1,'JUAN PEREZ','19/04/2002','MASCULINO','1ER SEMESTRE','CDMX',1);

INSERT INTO ALUMNO VALUES 
(2,'DIANA MORALES','19/04/2001','FEMENINO','3ER SEMESTRE','CDMX',1);

INSERT INTO ALUMNO VALUES 
(3,'ROSY FARFAN','19/01/2000','FEMENINO','5ER SEMESTRE','CDMX',1);

--CONSULTAR LA INFO GUARDADA EN LA TABLA ALUMNO HASTA EL MOMNETO
SELECT * FROM ALUMNO;

-- SI QUIERO CONFIRMAR EL GUARDADO DE LA INFO DE LOS ALUMNOS EN LA BASE DE DATOS
COMMIT; 

--INSERTAR VALORES EN NUESTRA TABLA CARRERAS
DESCRIBE carreras;

INSERT INTO CARRERAS VALUES(1,'ING.SISTEMAS','CIENCIAS EXACTAS','8 SEMESTRES');

INSERT INTO CARRERAS VALUES(2,'MEDICINA','CIENCIAS DE LA SALUD','10 SEMESTRES');

INSERT INTO CARRERAS VALUES(3,'MECATRONICA','CIENCIAS EXACTAS','8 SEMESTRES');

SELECT * FROM CARRERAS;

COMMIT;

--Actualizar la informacion o editar la info de una columna o columnas
UPDATE CARRERAS SET NOMBRE='MEDICINA' WHERE CARRERA_ID =2;

UPDATE CARRERAS SET NOMBRE='MEDICO CIRUJANO', DURACION ='11 SEMESTRES' WHERE CARRERA_ID=2;

--SI QUIERO QUE SE MANTEGA LA ACTUALIZACION HAY QUE CONFIRMARLA
COMMIT;

--VAMOS A INSERTAR INFO EN LA TABLA RELACIONAL CARRERA_ALUMNOS
DESCRIBE CARRERAS_ALUMNOS;

INSERT INTO CARRERAS_ALUMNOS VALUES (1,1,3);
--ALUMNO 1 EN CARRERa 3

INSERT INTO CARRERAS_ALUMNOS VALUES (2,2,3);

INSERT INTO CARRERAS_ALUMNOS VALUES (3,3,1);
INSERT INTO CARRERAS_ALUMNOS VALUES (4,2,5); --ESTA TIENE RESTRICION PORQUE NO EXISTE

SELECT * FROM carreras_alumnos;

COMMIT;

--Crear tabla tutores-------------------EJERCICIO 1

CREATE TABLE TUTORES(
TUTOR_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(30),
EMAIL NVARCHAR2(30),
CLAVE NVARCHAR2(4)
);

--RESTRICCION-- CHK
ALTER TABLE TUTORES ADD CONSTRAINT CHK_CLAVE
CHECK (CLAVE IN ('A','B','C','D'));

DESCRIBE TUTORES;
INSERT INTO TUTORES VALUES (1,'MARINA SHERLIN','MARI@GMAIL.COM','A');
INSERT INTO TUTORES VALUES (2,'JUAN BLANCAS','JANFE@GMAIL.COM','B');
INSERT INTO TUTORES VALUES (3,'MARIA ESPINOSA','MARI435@GMAIL.COM','D');

SELECT * FROM TUTORES;

COMMIT;

------TABLA RELACIONAL---

CREATE TABLE TUTORES_ALUMNOS(
TA_ID NUMBER PRIMARY KEY,
TUTOR_ID NUMBER,
ALUMNO_ID NUMBER
);


--RESTRICCION DE LLAVES FORANEAS (FOREIGN KEY)
ALTER TABLE TUTORES_ALUMNOS ADD CONSTRAINT FK_ALUMNO_ID_TA
FOREIGN KEY (ALUMNO_ID)
REFERENCES ALUMNO (ALUMNO_ID);

ALTER TABLE TUTORES_ALUMNOS ADD CONSTRAINT FK_TUTORES_ID_TA
FOREIGN KEY (TUTOR_ID)
REFERENCES TUTORES (TUTOR_ID);

INSERT INTO TUTORES_ALUMNOS VALUES (1,2,3);
INSERT INTO TUTORES_ALUMNOS VALUES (2,1,2);
INSERT INTO TUTORES_ALUMNOS VALUES (3,3,1);

INSERT INTO TUTORES_ALUMNO VALUES (4,6,7);

-------TABLE STATUS_DESCRIPCION---
CREATE TABLE STATUS_DESCRIPCION (
STATUS_ID NUMBER PRIMARY KEY,
DESCRIPCION NVARCHAR2(30)
);

INSERT INTO STATUS_DESCRIPCION VALUES(0,'ALUMNO NO INSCRITO');
INSERT INTO STATUS_DESCRIPCION VALUES(1,'ALUMNO INSCRITO');

---FK----
ALTER TABLE ALUMNO ADD CONSTRAINT FK_STATUS_ID_TA
FOREIGN KEY (STATUS)--REFERENTE A LA MIMS TABLA
REFERENCES STATUS_DESCRIPCION (STATUS_ID);--DE DONDE VIENE


SELECT * FROM STATUS_DESCRIPCION;

--PROBAR STAUTS
INSERT INTO ALUMNO VALUES 
(4,'JUAN MONROY','9/04/2012','MASCULINO','1ER SEMESTRE','CDMX',5);



------------------Libros--------------------------------EJERCICO 2

CREATE TABLE AUTORES(
AUTOR_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(30),
NACIONALIDAD NVARCHAR2(30)
);

CREATE TABLE LIBROS(
LIBRO_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(50),
AUTOR_ID NUMBER,
DISPONIBILIDAD NUMBER
);

CREATE TABLE SOCIOS(
SOCIO_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(30),
DIRECCION NVARCHAR2(50),
TELEFONO NUMBER(10)
);


CREATE TABLE PRESTAMOS(
PRESTAMO_ID NUMBER PRIMARY KEY,
SOCIO_ID NUMBER,
LIBRO_ID NUMBER,
FECHA_PRESTAMO DATE,
FECHA_DEVOLUCION DATE
);

--------------------RESTRICIONES--------
---RESTRICCION EN NOMBRE DE LIBRO PARA QUE SEA UNICO
--CON UNIQUE
ALTER TABLE LIBROS ADD CONSTRAINT UNI_NOMBRE_LIBROS
UNIQUE(NOMBRE);

ALTER TABLE SOCIOS ADD CONSTRAINT UNI_TELEFONO_SOCIOS
UNIQUE(TELEFONO);

-------FOREIGN KEY------
ALTER TABLE LIBROS ADD CONSTRAINT FK_AUTOR_ID_LI
FOREIGN KEY (AUTOR_ID)
REFERENCES AUTORES (AUTOR_ID);

ALTER TABLE PRESTAMOS ADD CONSTRAINT FK_LIBRO_ID_LIBRO
FOREIGN KEY (LIBRO_ID)
REFERENCES LIBROS(LIBRO_ID);

ALTER TABLE PRESTAMOS ADD CONSTRAINT FK_SOCIO_ID_SOCIO
FOREIGN KEY (SOCIO_ID)
REFERENCES SOCIOS(SOCIO_ID);


-------INSERTAR DATOS----------
DESCRIBE AUTORES;
INSERT INTO AUTORES VALUES(1,'Gabriel Garcia Marquez','Colombia');
INSERT INTO AUTORES VALUES(2,'Mario vargas LLosa','Peru');
INSERT INTO AUTORES VALUES(3,'J.K Rowling','Reino Unido');
INSERT INTO AUTORES VALUES(4,'Isabel Allende','Chile');
INSERT INTO AUTORES VALUES(5,'Harumi Murakami','Japon');

SELECT * FROM AUTORES;

DESCRIBE LIBROS;
INSERT INTO LIBROS VALUES(1,'Cien alos de soledad',1,100);
INSERT INTO LIBROS VALUES(2,'La fiesta del chivo',2,500);
INSERT INTO LIBROS VALUES(3,'Harry Ptter y la camara secreta',3,5000);
INSERT INTO LIBROS VALUES(4,'Evaluna',4,200);
INSERT INTO LIBROS VALUES(5,'1Q84',5,600);

INSERT INTO LIBROS VALUES(6,'RAMBO',20,43040);

SELECT *FROM LIBROS;

DESCRIBE SOCIOS;

INSERT INTO SOCIOS VALUES (1,'Carlos Rodriguez','C. falsa 123,Ciudad real',5512345678);
INSERT INTO SOCIOS VALUES (2,'Ana Garcia','Av. del sol 456,Monterrey',5523346934);
INSERT INTO SOCIOS VALUES (3,'Luis Perez','C. Luna 789,Guadalajara',5534568790);
INSERT INTO SOCIOS VALUES (4,'Martha Sanchez','C. del  rio 101,Buenos Aires',5753465210);
INSERT INTO SOCIOS VALUES (5,'Pedro Martinez','C.Mayor 202,Barcelona',4345657698);

INSERT INTO SOCIOS VALUES (6,'Pedro Martinez','C.Mayor 202,Barcelona',4345657698);

SELECT * FROM SOCIOS;

DESCRIBE PRESTAMOS;
INSERT INTO PRESTAMOS VALUES(1,5,2,'10/05/2025','09/06/2025');
INSERT INTO PRESTAMOS VALUES(2,4,3,'11/01/2025','10/07/2025');
INSERT INTO PRESTAMOS VALUES(3,3,4,'06/003/2025','07/05/2025');
INSERT INTO PRESTAMOS VALUES(4,2,5,'26/05/2025','02/08/2025');
INSERT INTO PRESTAMOS VALUES(5,1,1,'10/08/2025','10/09/2025');

INSERT INTO PRESTAMOS VALUES(6,1,6,'21/05/2025','12/06/2025');

SELECT * FROM PRESTAMOS;

COMMIT;

---------------------------------------------

--CREACION DE SECUENCIAS
--Las secuencias son objetos que se emplean para generar 
--valores numericos secuenciales o consecutivos
--pueden tener un incremento de 1 en 1 o algun otro
--En este caso ese valor lo vamos a utiliar para poder isertarlo
--posteriormente en las llaves primarias y asi aseguranos que los 
--valores no se repitan

--ej. CREAR UNA SECEUNCIA PARA UNA TABLA QUE YA TIENE VALORES REGISTRADOS

SELECT * FROM ALUMNO;

CREATE SEQUENCE ALUMNO_SEQ
START WITH 4
INCREMENT BY 1
NOCACHE;

-- TRIGGER (DISPARADOR)
--ES UN TIPO DE PROCEDIMIENTO ALMACENADO QUE SE ENCARGA DE DESENCADENAR
--UN EVENTO. EN ESTE CASO LO UTILIZAREMOS PARA INSERTAR LOS IDs.

CREATE OR REPLACE TRIGGER INSERT_ALUMNO
BEFORE INSERT ON ALUMNO FOR EACH ROW
BEGIN
    SELECT ALUMNO_SEQ.NEXTVAL INTO:NEW.ALUMNO_ID FROM DUAL;
END;

-- PROBAMOS COMO INSERTAR UN NUEVOO ALUMNO AHORA QUE YA TENEMOS SECUENCIA Y DISPARADOR
INSERT INTO ALUMNO VALUES
(1,'MARIA','23/07/98','FEMENINO','2DO SEMESTRE','TUXTLA GTZ',1);

SELECT * FROM ALUMNO;


--OTRA SIMTAXIS PARA INSERTAR ALUMNOS ES INDICAR QUE COLUMNAS VAMOS A INSERTAR
INSERT INTO ALUMNO (NOMBRE,FECHANAC,GENERO,GRADO,CIUDAD,STATUS) VALUES
('ANDRES','31/12/22','MASCULINO','1ER SEMESTRE','VERACRUZ',2);

--EJ CREAR SECUENCIA CON VALORES POR DEFECTO, ES DECIR QUE INICIE DESDE EL NUMERO 1
--ES UTIL PARA TABLAS QUE AUN TIENE VALORES ISERTADOS
CREATE SEQUENCE CARRERAS_SEQ;

--CREAMOS EL DISPARADOR PARA LA TABALA CARRERAS
CREATE OR REPLACE TRIGGER INSERT_CARRERAS
BEFORE INSERT ON CARRERAS FOR EACH ROW
BEGIN
    SELECT CARRERAS_SEQ.NEXTVAL INTO:NEW.CARRERA_ID FROM DUAL;
END;

--CONSULTO MIS CARRERAS
SELECT * FROM CARRERAS;

--INTENTO INSERTAR UNA NUEVA CARRERA
INSERT INTO CARRERAS VALUES
(1,'NUTRICION','CIENCIAS DE LA SALUD','8SEMESTRES');
--MARCA ERROR POR LA SECUENCIA HASTA QUE ENCEUNTRE EL VALOR LIBERADO

SELECT * FROM CARRERAS;

COMMIT;

----------------------------------------------------------
---EJERCICIO 3------
----------------------------------------------------------

--CREAR TABLAS
CREATE TABLE MIEMBROS(
MIEMBRO_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(50),
FECHA_NAC DATE,
TELEFONO NVARCHAR2(10)
);

CREATE TABLE ENTRENADORES (
ENTRENADOR_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(50),
ESPECIALIDAD NVARCHAR2(50)
);

CREATE TABLE CLASES (
CLASE_ID NUMBER PRIMARY KEY,
NOMBRE_CLASE NVARCHAR2(50),
FECHAINICIO DATE,
FECHAFIN DATE,
ENTRENADOR_ID NUMBER
);

CREATE TABLE INSCRIPCIONES(
INSCRIPCION_ID NUMBER PRIMARY KEY,
MIEMBRO_ID NUMBER,
CALSE_ID NUMBER,
FECHA_INSCRIPCION DATE
);

---------------------------------
--RESTINCIONES

ALTER TABLE CLASES ADD CONSTRAINT FK_ENTRENADOR_ID_C
FOREIGN KEY (ENTRENADOR_ID)
REFERENCES ENTRENADORES (ENTRENADOR_ID);

ALTER TABLE INSCRIPCIONES ADD CONSTRAINT FK_MIEMBRO_ID_I
FOREIGN KEY (MIEMBRO_ID)
REFERENCES MIEMBROS (MIEMBRO_ID);

ALTER TABLE INSCRIPCIONES ADD CONSTRAINT FK_CLASE_ID_INS
FOREIGN KEY (CALSE_ID)
REFERENCES CLASES (CLASE_ID);

------------------------------------------
--SECUENCIAS

CREATE SEQUENCE MIEMBROS_SEQ;
CREATE SEQUENCE ENTRENADORES_SEQ;
CREATE SEQUENCE CLASES_SEQ;
CREATE SEQUENCE INSCRIPCIONES_SEQ;

--------------------------------------------
--DISPARADOR

CREATE OR REPLACE TRIGGER INSERT_MIEMBROS
BEFORE INSERT ON MIEMBROS FOR EACH ROW
BEGIN
    SELECT MIEMBROS_SEQ.NEXTVAL INTO:NEW.MIEMBRO_ID FROM DUAL;
END;

CREATE OR REPLACE TRIGGER INSERT_ENTRENADORES
BEFORE INSERT ON ENTRENADORES FOR EACH ROW
BEGIN
    SELECT ENTRENADORES_SEQ.NEXTVAL INTO:NEW.ENTRENADOR_ID FROM DUAL;
END;

CREATE OR REPLACE TRIGGER INSERT_CLASES
BEFORE INSERT ON CLASES FOR EACH ROW
BEGIN
    SELECT CLASES_SEQ.NEXTVAL INTO:NEW.CLASE_ID FROM DUAL;
END;


CREATE OR REPLACE TRIGGER INSERT_INSCRIPCIONES
BEFORE INSERT ON INSCRIPCIONES FOR EACH ROW
BEGIN
    SELECT INSCRIPCIONES_SEQ.NEXTVAL INTO:NEW.INSCRIPCION_ID FROM DUAL;
END;

----------------------------
------VALUES
DESCRIBE MIEMBROS;
INSERT INTO MIEMBROS VALUES(1,'MARIANA','17/10/02','5635357845');
INSERT INTO MIEMBROS VALUES(1,'ROCIO','19/01/98','5635354345');
INSERT INTO MIEMBROS VALUES(1,'MARIA','06/06/99','5643567809');

SELECT * FROM MIEMBROS;

DESCRIBE ENTRENADORES;
INSERT INTO ENTRENADORES VALUES(1,'ROMULO RIVAS','CROSSFIT');
INSERT INTO ENTRENADORES VALUES(1,'JUAN LOPEZ','PESAS');
INSERT INTO ENTRENADORES VALUES(1,'ERICKA SANDOVAL','ZUMBA');

SELECT * FROM ENTRENADORES;

DESCRIBE CLASES;
INSERT INTO CLASES VALUES(1,'YOGA','06/06/25','06/07/25',3);
INSERT INTO CLASES VALUES(1,'CROSFFIT','09/05/25','09/07/25',1);
INSERT INTO CLASES VALUES(1,'ENTRENAMEINTO FUNCIONAL','01/05/25','01/08/25',2);

SELECT * FROM CLASES;

DESCRIBE INSCRIPCIONES;
INSERT INTO INSCRIPCIONES VALUES(1,1,2,'09/05/25');
INSERT INTO INSCRIPCIONES VALUES(1,2,3,'01/05/25');
INSERT INTO INSCRIPCIONES VALUES(1,3,1,'06/06/25');

INSERT INTO INSCRIPCIONES VALUES(1,5,8,'06/06/25');

SELECT * FROM INSCRIPCIONES;
COMMIT;


--------------------------------------------------------------------------
--EJERCICIO ABOGADOS

--ENTIDADES FUERTES
CREATE TABLE CLIENTES (
CLIENTE_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(30),
DIRECCION NVARCHAR2(50),
TELEFONO NVARCHAR2(10)
);

CREATE TABLE PROCURADORES (
PROCURADOR_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(30),
DIRECCION NVARCHAR2(50),
TELEFONO NVARCHAR2(10),
HONORARIOS NUMBER
);

-----ENTIDAD DEBIL
CREATE TABLE ASUNTOS(
ASUNTO_ID NUMBER PRIMARY KEY,
NOMBRE NVARCHAR2(50),
FECHA_INICIO DATE,
FECHA_FIN DATE,
ESTADO NVARCHAR2(30),
CLIENTE_ID NUMBER
);

CREATE TABLE ASIGNACIONES(
ASIGNACION_ID NUMBER PRIMARY KEY,
ASUNTO_ID NUMBER,
PROCURADOR_ID NUMBER
);

------RESTRICICONES
--CHEK
ALTER TABLE ASUNTOS ADD CONSTRAINT CHK_ESTADO
CHECK (ESTADO IN ('ARCHIVADO', 'EN TRAMITE'));

----SECUENCIAS
CREATE SEQUENCE CLIENTES_SEQ;
CREATE SEQUENCE ASUNTOS_SEQ;
CREATE SEQUENCE PROCURADORES_SEQ;
CREATE SEQUENCE ASIGNACIONES_SEQ;

----- TRIGGERS DISPARADOR
CREATE OR REPLACE TRIGGER INSERT_CLIENTES
BEFORE INSERT ON CLIENTES FOR EACH ROW
BEGIN
    SELECT CLIENTES_SEQ.NEXTVAL INTO:NEW.CLIENTE_ID FROM DUAL;
END;

CREATE OR REPLACE TRIGGER INSERT_ASUNTOS
BEFORE INSERT ON ASUNTOS FOR EACH ROW
BEGIN
    SELECT ASUNTOS_SEQ.NEXTVAL INTO:NEW.ASUNTO_ID FROM DUAL;
END;

CREATE OR REPLACE TRIGGER INSERT_PROCURADORES
BEFORE INSERT ON PROCURADORES FOR EACH ROW
BEGIN
    SELECT PROCURADORES_SEQ.NEXTVAL INTO:NEW.PROCURADOR_ID FROM DUAL;
END;

CREATE OR REPLACE TRIGGER INSERT_ASIGNACIONES
BEFORE INSERT ON ASIGNACIONES FOR EACH ROW
BEGIN
    SELECT ASIGNACIONES_SEQ.NEXTVAL INTO:NEW.ASIGNACION_ID FROM DUAL;
END;

--- VALUES

INSERT INTO CLIENTES VALUES(1,'MARTIN LEMUS', 'CALLE ANCHA,CDMX','5598424365');
INSERT INTO CLIENTES VALUES(1,'JOSE MANUE,', 'PORFIRIO DIAZ,CDMX','5587458909');
INSERT INTO CLIENTES VALUES(1,'JESUS MALDONADO', '20 DE NOVIEMBRE,CDMX','5532457698');
INSERT INTO CLIENTES VALUES(1,'MIGUEL MARTINEZ', 'BENITO JUAREZ,CDMX','5521436532');
INSERT INTO CLIENTES VALUES(1,'FERNANDO FIGUEROA', 'ALVARO OBREGON,CDMX','5528930443');

INSERT INTO PROCURADORES VALUES(1,'RAMIRO BLANCAS', 'CALLE ANCHA,CDMX','5543658709',2);
INSERT INTO PROCURADORES VALUES(1,'RAFAEL RIVAS', 'BENITO JUAREZ,CDMX','5543658709',1);
INSERT INTO PROCURADORES VALUES(1,'MARGARITA BLANCAS', 'INDEPENDECNIA,CDMX','5543658709',3);
INSERT INTO PROCURADORES VALUES(1,'ROMULO BLANCO', 'GUADALUPE VICTORIA,CDMX','5543658709',1);
INSERT INTO PROCURADORES VALUES(1,'HECTOR MALDONADO', 'PORFIRIO,CDMX','5543658709',2);

INSERT INTO ASUNTOS VALUES(1,'FRIDA MARTINEZ', '01/02/20','05/04/25','EN TRAMITE',1);
INSERT INTO ASUNTOS VALUES(1,'CRISTIAN OVERA', '09/07/21','05/01/25','ARCHIVADO',2);
INSERT INTO ASUNTOS VALUES(1,'EDUARDA TORRES', '04/03/22','05/02/25','ARCHIVADO',3);
INSERT INTO ASUNTOS VALUES(1,'EDITH RIVAS', '15/04/23','05/04/23','EN TRAMITE',4);
INSERT INTO ASUNTOS VALUES(1,'MIGUEL RIVAS', '19/05/24','05/04/26','EN TRAMITE',5);

INSERT INTO ASIGNACIONES VALUES(1,1,1);
INSERT INTO ASIGNACIONES VALUES(1,2,5);
INSERT INTO ASIGNACIONES VALUES(1,3,4);
INSERT INTO ASIGNACIONES VALUES(1,4,3);
INSERT INTO ASIGNACIONES VALUES(1,5,2);

SELECT * FROM CLIENTES;
SELECT * FROM PROCURADORES;
SELECT * FROM ASUNTOS;
SELECT * FROM ASIGNACIONES;

DESCRIBE ASUNTOS;
UPDATE ASUNTOS SET NOMBRE='DIVORCIO' WHERE ASUNTO_ID =2;
UPDATE ASUNTOS SET NOMBRE='PENSION ALIMENTICIA' WHERE ASUNTO_ID =1;
UPDATE ASUNTOS SET NOMBRE='HERENCIA' WHERE ASUNTO_ID =3;
UPDATE ASUNTOS SET NOMBRE='ROBO' WHERE ASUNTO_ID =4;
UPDATE ASUNTOS SET NOMBRE='CUSTODIA' WHERE ASUNTO_ID =5;

commit;

--------------------------------------
--Añadir una colmna a una tabla existente
--EJ AÑADIR UNA COLUMNA LLAMADA PRESUPUESTO A LA TABALA CARRERAS


ALTER TABLE CARRERAS ADD PRESUPUESTO NVARCHAR2(10);
DESCRIBE CARRERAS;
SELECT * FROM CARRERAS;


--------------------------------------
--CAMBIAR EL TIPO DE DATO DE UNA COLUMNA SIEMPRE Y CUANDO AUN NO TENGA VALORES

ALTER TABLE CARRERAS MODIFY PRESUPUESTO NUMBER (8,2);-- NUMBER SE PUEDE DELIMITAR CON ()

--------------------------------------
--CAMBIAR EL NOMBRE DE UNA COLUMNA DE UNA TABLA
ALTER TABLE CARRERAS RENAME COLUMN PRESUPUESTO TO PRESUPUESTO_MENSUAL;

--INSERTAR UNA NUEVA CARRERAYA CON TODOS SUS VALORES
INSERT INTO CARRERAS VALUES (1,'ADMINISTRACION DE EMPRESAS','ECONOMIA','8 SEMESTRES',10500.50);

COMMIT;
--------------------------------------
-- BORRAR UNA FILA UN REGISTRO DE UNA TABLA
--EN ESTE EJEMPLO CUANDO MI CARRERA EXISTE COMO REGISTRO SECUNDARIO
--NO ME ES POSIBLE ELIMINARLO, A MENOS QUE LA ELIMINE PRIMERO DE LA TABLA
-- SECUNDARIA (CARRERAS-ALUMNO)
DELETE FROM CARRERAS WHERE CARRERA_ID = 1; 

DELETE FROM CARRERAS WHERE CARRERA_ID = 5; 

----------------------------------------
--PUEDO REGRESAR AL ESTADO DEL ULTIMO COMMIT CON UNA INSTRUCCION LLAMADA ROLLBACK
ROLLBACK;

--DIFERENCIAS ENTRE DELETE, TRUNCATE Y DROP
--DELETE PUEDE BORRAR UNA FILA O TODAS LAS FILAS DE UNA TABLA PERO DEBE CONFIRMARSE
--O PODEMOS REGRESAR AL ESTADO DEL ULTIMO COMIIT CON ROLLBACK

--TRUNCATE, ELIMINA TODAS LAS FILAS DE UNA TABLA, PERO CONFIRMA EL BORRADO
--DROP- ELIMINA TODA LA TABLA Y TODA LA INFORMACION

--ELIMINAR LA INFO DE UNA COLUMNA
UPDATE CARRERAS SET DURACION=NULL; --VACIAR LA COLUMNA DE LA INFORMACION

--ELIMINAR UNA COLUMNA DE UNA TABLA. EJ. LA COLUMNA PRESUPUESTO_MENSUAL
ALTER TABLE CARRERAS DROP COLUMN PRESUPUESTO_MENSUAL; -- ELIMINA TODA LA COLUMNA CON LA INFORMACION 

-----------------------------------------
--CONSULTAS GENERAL (CONSULTAR TODO DE UNA TABLA)
SELECT * FROM CARRERAS;
--CONSULTAR ALGUNAS COLUMNAS DE UNA TABLE
SELECT CARRERA_ID,NOMBRE,DURACION FROM CARRERAS;

SELECT ALUMNO_ID,NOMBRE,GENERO FROM ALUMNO;

---CONSULTAR INFORMACION DE UNA TABLA DE ACUERDO A UNA CONDICCION
--EJ. CONSULTAR INFO DE UN SOLO ALUMNO
SELECT * FROM ALUMNO WHERE ALUMNO_ID=5;

--CONSULTAR INFO DE LOS ALUMNOS CON STATUS=0
SELECT * FROM ALUMNO WHERE STATUS=1;

--EJ CONSULTAR INFO DE UNA CARRERA CON UN RANGO DE PRESUPUESTO
SELECT * FROM CARRERAS WHERE PRESUPUESTO_MENSUAL>10000;

--CONSULTAR INFO DE UNA TABLA DE ACUERDO A MAS DE UNA CONDICION CON EL OPERADOR
--AND
SELECT * FROM CARRERAS WHERE PRESUPUESTO_MENSUAL>10000 AND AREA='CIENCIAS DE LA SALUD';

-- CONSULTAR INFO DE UNA TABLA QUE ESTE EN UN RANGO DETERMINADO DE PRESUPUESTO
--CON LA CONSULTA BETWEEN
SELECT * FROM CARRERAS WHERE PRESUPUESTO_MENSUAL BETWEEN 10000 AND 15000;

--CONSULTAR VALORES O INFO DE UNA TABLA EN DONDE UNA COLUMNA INICIE CON VALORES SIMILARES
SELECT * FROM ALUMNO WHERE NOMBRE LIKE 'A%';

--APELLIDO
SELECT * FROM ALUMNO WHERE NOMBRE LIKE'%PEREZ';
SELECT * FROM CLIENTES WHERE TELEFONO LIKE'55%';

--FUNCIONES DE AGREGACION------
--CONSULTAR EL VALOR MAXIMO DE UNA COLUMNA
SELECT MAX (PRESUPUESTO_MENSUAL) FROM CARRERAS;

--CONSULTAR EL VALOR MINIMO DE UNA COLUMNA
SELECT MIN (PRESUPUESTO_MENSUAL) FROM CARRERAS;

--REALIZAR O CONSULTAR LA SUMATORIA DE VALORES DE UNA COLUMNA
SELECT SUM (PRESUPUESTO_MENSUAL) FROM CARRERAS;

--CONSULTAR EL PROMEDIO DE LOS VALORES DE UNA COLUMNA 
SELECT AVG (PRESUPUESTO_MENSUAL) FROM CARRERAS;

--REALIZAR UN CONTEO DE LOS REGISTROS DE UNA TABLA
SELECT COUNT (*) FROM ALUMNO;

--PODEMOS UTILIZAR EL CONTEO EN CONJUNTO CON OTRA COLUMNA PARA AGRUPAR VALORES
SELECT COUNT(*),GENERO FROM ALUMNO GROUP BY GENERO;

--COMO PODEMOS ORDENAR NUESTROS REGISTROS DE ACUERDO A LOS VALORES DE UNA COLUMNA
--DE FORMA ASCEDENTE

SELECT * FROM ALUMNO ORDER BY ALUMNO_ID;
SELECT * FROM CARRERAS ORDER BY CARRERA_ID;

SELECT * FROM ALUMNO ORDER BY NOMBRE;

-- ORDENAR LOS REGISTROS DE FORMA DESCENDENTE
SELECT * FROM ALUMNO ORDER BY ALUMNO_ID DESC;
SELECT * FROM ALUMNO ORDER BY NOMBRE DESC;

----------------------------------------------
--CONSULTAS ANIDADAS - UNA CONSULTA DENTRO DE OTR
--EJ, CONSULTAR LA CARRERA QUE MAS PRESUPUESTO MENSUAL TIENE
SELECT * FROM CARRERAS WHERE PRESUPUESTO_MENSUAL=
(SELECT MAX(PRESUPUESTO_MENSUAL)FROM CARRERAS);

--TODOS LOS DATOS DE PROCURADOR PARA SABER DONDE LLEVE TODOS SUS ASUNTOS


--CONSULTAR LA INFO  DEL TUTOR QUE LE DA CLSE O ASESORIAS A 'JORGE MENDEZ'
SELECT * FROM TUTORES WHERE TUTOR_ID IN
(SELECT TUTOR_ID FROM TUTORES_ALUMNOS WHERE ALUMNO_ID IN
(SELECT ALUMNO_ID FROM ALUMNO WHERE NOMBRE='JUAN PEREZ'));

---------------------------------------------------------------------
--CONSULTAS CON JOIN------------------------
---------------------------------------------------------------------
--SON CONSULTAS QUE NOS DEVUELVEN INFO DE LAS TABLAS LAS CUALES PUEDEN 
--UNIRSE POR UN CAMPO EN COMUN (GENERALMENTE PRIMARY KEY Y FOREIGN KEY)

--INNER JOIN- DEVUELVE LAS FILAS COINCIDENTES ENTRE UNA TABLA A Y UNA TABLA B
SELECT * FROM ALUMNO;
SELECT * FROM CARRERAS_ALUMNOS;

SELECT * FROM ALUMNO    
INNER JOIN CARRERAS_ALUMNOS 
ON ALUMNO.ALUMNO_ID = CARRERAS_ALUMNOS.ALUMNO_ID;
--DONDE SE UNEN

--LETF JOIN
--MUESTRA O PRIORIZA LA INFORMACION DE LA TABLA A
-- Y SOLO LO COINCIDENTE CON LA TABLA B
SELECT * FROM ALUMNO    
LEFT JOIN CARRERAS_ALUMNOS 
ON ALUMNO.ALUMNO_ID = CARRERAS_ALUMNOS.ALUMNO_ID;

--RIGHT JOIN
--MUESTRA TODO LO DE LA TABLA B
--Y SOLO LO COINCIDENTE CON LA TABLA A
SELECT * FROM ALUMNO    
RIGHT JOIN CARRERAS_ALUMNOS 
ON ALUMNO.ALUMNO_ID = CARRERAS_ALUMNOS.ALUMNO_ID;


--FULL OUTER JOIN
--MUESTRA TODO DE AMBAS TABLAS
SELECT * FROM ALUMNO    
FULL OUTER JOIN CARRERAS_ALUMNOS 
ON ALUMNO.ALUMNO_ID = CARRERAS_ALUMNOS.ALUMNO_ID;

--PODEMOS UNIR MAS DE DOS TABLAS
SELECT * FROM ALUMNO    
INNER JOIN CARRERAS_ALUMNOS 
ON ALUMNO.ALUMNO_ID = CARRERAS_ALUMNOS.ALUMNO_ID
INNER JOIN CARRERAS
ON CARRERAS.CARRERA_ID = CARRERAS_ALUMNOS.CARRERA_ID;

--PODEMOS UNA VEZ UNIDAS LAS TABLAS SOLO SELECCIONAR ALGUNAS COLUMNAS
SELECT ALUMNO.ALUMNO_ID,ALUMNO.NOMBRE,CARRERAS.NOMBRE, CARRERAS.DURACION FROM ALUMNO    
INNER JOIN CARRERAS_ALUMNOS 
ON ALUMNO.ALUMNO_ID = CARRERAS_ALUMNOS.ALUMNO_ID
INNER JOIN CARRERAS
ON CARRERAS.CARRERA_ID = CARRERAS_ALUMNOS.CARRERA_ID;

--PODEMOS AGREGAR ALIAS A LAS TABALS PARA IDENTIFICAR Y ACORTAR LA SINTAXIS
SELECT A.ALUMNO_ID,A.NOMBRE,C.NOMBRE, C.DURACION FROM ALUMNO A   
INNER JOIN CARRERAS_ALUMNOS CA
ON A.ALUMNO_ID = CA.ALUMNO_ID
INNER JOIN CARRERAS C
ON C.CARRERA_ID = CA.CARRERA_ID;

--EMCABEZADOS DE LAS COLUMNAS
SELECT A.ALUMNO_ID AS MATRICULA,A.NOMBRE AS ALUMNO,C.NOMBRE AS CARRERA, C.DURACION FROM ALUMNO A   
JOIN CARRERAS_ALUMNOS CA
ON A.ALUMNO_ID = CA.ALUMNO_ID
JOIN CARRERAS C
ON C.CARRERA_ID = CA.CARRERA_ID;

--CONSULTAR LA INFO DEL TUTOR QUE LE DA CLASES O ASESORIAS A JORGE MENDEZ
--RESOLVER CON JOINS
SELECT * FROM TUTORES    
INNER JOIN TUTORES_ALUMNOS 
ON TUTORES.TUTOR_ID = TUTORES_ALUMNOS.TUTOR_ID
INNER JOIN ALUMNO
ON ALUMNO.ALUMNO_ID = TUTORES_ALUMNOS.ALUMNO_ID
WHERE ALUMNO.NOMBRE='JUAN PEREZ';


SELECT T.TUTOR_ID, T.NOMBRE,T.EMAIL,T.CLAVE FROM TUTORES T
JOIN TUTORES_ALUMNOS TA
ON T.TUTOR_ID = TA.TUTOR_ID
JOIN ALUMNO A
ON A.ALUMNO_ID = TA.ALUMNO_ID
WHERE A.NOMBRE='JUAN PEREZ';



